"use strict";(globalThis.webpackChunkflowra_docs=globalThis.webpackChunkflowra_docs||[]).push([[726],{5024:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>t,contentTitle:()=>l,default:()=>c,frontMatter:()=>d,metadata:()=>a,toc:()=>o});const a=JSON.parse('{"id":"data/models-and-queries","title":"Models & Queries","description":"Gunakan Flowra models dan query classes untuk mengenkapsulasi akses database.","source":"@site/i18n/id/docusaurus-plugin-content-docs/current/data/models-and-queries.mdx","sourceDirName":"data","slug":"/data/models-and-queries","permalink":"/id/docs/data/models-and-queries","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"Models & Queries","description":"Gunakan Flowra models dan query classes untuk mengenkapsulasi akses database."},"sidebar":"docsSidebar","previous":{"title":"Konfigurasi Database","permalink":"/id/docs/data/knex-configuration"},"next":{"title":"Migrations & Seeds","permalink":"/id/docs/data/migrations-and-seeds"}}');var r=s(4848),i=s(8453);const d={title:"Models & Queries",description:"Gunakan Flowra models dan query classes untuk mengenkapsulasi akses database."},l=void 0,t={},o=[{value:"Base class Model",id:"base-class-model",level:2},{value:"Helper di Service",id:"helper-di-service",level:2},{value:"Query Builder (Knex)",id:"query-builder-knex",level:2},{value:"Query read",id:"query-read",level:3},{value:"Join dan agregasi",id:"join-dan-agregasi",level:3},{value:"Write dan transaksi",id:"write-dan-transaksi",level:3},{value:"Query classes",id:"query-classes",level:2},{value:"Wiring models dan queries",id:"wiring-models-dan-queries",level:2}];function u(e){const n={admonition:"admonition",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(n.p,{children:["Flowra models mewarisi base class ",(0,r.jsx)(n.code,{children:"Service"})," yang membungkus Knex dan menyediakan helper untuk read, write, dan timestamps."]}),"\n",(0,r.jsx)(n.h2,{id:"base-class-model",children:"Base class Model"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"app/Config/Model.js"})," memperluas ",(0,r.jsx)(n.code,{children:"Service"})," dan menyediakan default untuk table name, primary key, dan allowed fields."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",metastring:'title="app/Modules/Users/Users.model.js"',children:"const Model = require('../../Config/Model');\n\nclass UsersModel extends Model {\n  constructor(connection = 'default') {\n    super(connection);\n    this.setTable('users');\n    this.setPrimaryKey('id');\n    this.setAllowedFields(['id', 'username', 'email', 'password']);\n    this.setTimestamps(true);\n    this.setSoftDelete(false);\n  }\n\n  async findAll() {\n    return this.read().select('*').whereNull('deletedAt');\n  }\n}\n\nmodule.exports = UsersModel;\n"})}),"\n",(0,r.jsx)(n.h2,{id:"helper-di-service",children:"Helper di Service"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"Service"})," menyediakan:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"read()"})," dan ",(0,r.jsx)(n.code,{children:"write()"})," untuk membangun query"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"save()"})," dan ",(0,r.jsx)(n.code,{children:"saveBulk()"})," untuk insert"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"update()"})," dan ",(0,r.jsx)(n.code,{children:"delete()"})," untuk mutasi"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"readKnex()"})," untuk memakai read replica bila tersedia"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"query-builder-knex",children:"Query Builder (Knex)"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Query Builder"})," Flowra adalah query builder Knex yang diakses melalui ",(0,r.jsx)(n.code,{children:"read()"})," dan ",(0,r.jsx)(n.code,{children:"write()"}),". Artinya Anda bisa memakai seluruh API Knex sambil menjaga alias koneksi tetap konsisten."]}),"\n",(0,r.jsxs)(n.p,{children:["Karena model Flowra sudah mengatur ",(0,r.jsx)(n.code,{children:"this.tableName"}),", Anda ",(0,r.jsx)(n.strong,{children:"tidak"})," perlu memanggil ",(0,r.jsx)(n.code,{children:".from('table')"})," untuk model yang sama kecuali saat melakukan join atau query lintas tabel."]}),"\n",(0,r.jsx)(n.h3,{id:"query-read",children:"Query read"}),"\n",(0,r.jsxs)(n.p,{children:["Gunakan ",(0,r.jsx)(n.code,{children:"read()"})," untuk select dan reporting:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",metastring:'title="app/Modules/Users/Users.model.js"',children:"getAll({ search, limit = 25, offset = 0 } = {}) {\n  const query = this.read()\n    .select('id', 'name', 'email', 'createdAt')\n    .orderBy('createdAt', 'desc')\n    .limit(limit)\n    .offset(offset);\n\n  if (search) {\n    query.where((builder) => {\n      builder\n        .where('email', 'like', `%${search}%`)\n        .orWhere('name', 'like', `%${search}%`);\n    });\n  }\n\n  return query;\n}\n\ngetSingle(id) {\n  return this.read()\n    .select('id', 'name', 'email', 'createdAt')\n    .where({ id })\n    .first();\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"join-dan-agregasi",children:"Join dan agregasi"}),"\n",(0,r.jsx)(n.p,{children:"Knex mendukung join dan agregasi untuk kebutuhan read yang lebih kaya:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",metastring:'title="app/Modules/Users/Users.model.js"',children:"getUsersWithTeams() {\n  return this.read()\n    .select('users.id', 'users.name', 'teams.name as teamName')\n    .leftJoin('teams', 'teams.id', 'users.teamId')\n    .orderBy('users.name', 'asc');\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"write-dan-transaksi",children:"Write dan transaksi"}),"\n",(0,r.jsxs)(n.p,{children:["Gunakan ",(0,r.jsx)(n.code,{children:"write()"})," saat butuh mutasi. Bungkus perubahan kompleks dalam transaksi:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",metastring:'title="app/Modules/Users/Users.model.js"',children:"async updateProfile(id, payload) {\n  const trx = await this.write().transaction();\n\n  try {\n    await this.write().transacting(trx).update(payload).where({ id });\n    await trx.commit();\n    return this.getSingle(id);\n  } catch (error) {\n    await trx.rollback();\n    throw error;\n  }\n}\n"})}),"\n",(0,r.jsx)(n.p,{children:"Karena Query Builder ini adalah Knex, Anda bisa memakai pola Knex yang sudah familiar tanpa keluar dari layer model Flowra."}),"\n",(0,r.jsx)(n.h2,{id:"query-classes",children:"Query classes"}),"\n",(0,r.jsx)(n.p,{children:"Query adalah class ringan untuk operasi read tertentu:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",metastring:'title="app/Modules/Welcome/SystemInfo.query.js"',children:"class SystemInfoQuery {\n  async execute() {\n    return {\n      environment: process.env.NODE_ENV || 'development',\n      nodeVersion: process.version,\n      uptime: process.uptime(),\n    };\n  }\n}\n\nmodule.exports = SystemInfoQuery;\n"})}),"\n",(0,r.jsx)(n.h2,{id:"wiring-models-dan-queries",children:"Wiring models dan queries"}),"\n",(0,r.jsx)(n.p,{children:"Daftarkan models dan queries di module container:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",metastring:'title="app/Modules/Users/users.container.js"',children:"const { asClass } = require('awilix');\nconst UsersModel = require('./Users.model');\n\nmodule.exports = (scope) => {\n  scope.register({\n    models: {\n      user: asClass(UsersModel).singleton(),\n    },\n  });\n};\n"})}),"\n",(0,r.jsx)(n.admonition,{title:"Jaga read dan write tetap jelas",type:"tip",children:(0,r.jsx)(n.p,{children:"Gunakan query classes untuk reporting dan services untuk business logic. Ini membuat kode tetap jelas dan mudah dites."})})]})}function c(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(u,{...e})}):u(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>d,x:()=>l});var a=s(6540);const r={},i=a.createContext(r);function d(e){const n=a.useContext(i);return a.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:d(e.components),a.createElement(i.Provider,{value:n},e.children)}}}]);