"use strict";(globalThis.webpackChunkflowra_docs=globalThis.webpackChunkflowra_docs||[]).push([[38],{3411:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>o,contentTitle:()=>l,default:()=>c,frontMatter:()=>i,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"getting-started/first-api","title":"Buat API Pertama Anda","description":"Bangun modul Users dengan CRUD + autentikasi, validasi request, dan wiring lengkap di Flowra.","source":"@site/i18n/id/docusaurus-plugin-content-docs/current/getting-started/first-api.mdx","sourceDirName":"getting-started","slug":"/getting-started/first-api","permalink":"/id/docs/getting-started/first-api","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"Buat API Pertama Anda","description":"Bangun modul Users dengan CRUD + autentikasi, validasi request, dan wiring lengkap di Flowra."},"sidebar":"docsSidebar","previous":{"title":"Struktur Proyek","permalink":"/id/docs/getting-started/project-structure"},"next":{"title":"Ringkasan Konfigurasi","permalink":"/id/docs/configuration/overview"}}');var a=r(4848),t=r(8453);const i={title:"Buat API Pertama Anda",description:"Bangun modul Users dengan CRUD + autentikasi, validasi request, dan wiring lengkap di Flowra."},l=void 0,o={},d=[{value:"1. Buat modul dan scaffold",id:"1-buat-modul-dan-scaffold",level:2},{value:"2. Buat migrasi dan jalankan database",id:"2-buat-migrasi-dan-jalankan-database",level:2},{value:"3. Perbarui model (Query Builder + Knex)",id:"3-perbarui-model-query-builder--knex",level:2},{value:"4. Perbarui service",id:"4-perbarui-service",level:2},{value:"5. Controller dengan validasi",id:"5-controller-dengan-validasi",level:2},{value:"6. Hubungkan routes",id:"6-hubungkan-routes",level:2},{value:"7. Daftarkan semuanya di container",id:"7-daftarkan-semuanya-di-container",level:2},{value:"8. Validasi modul dan cek routes",id:"8-validasi-modul-dan-cek-routes",level:2},{value:"9. Contoh alur UI CRUD",id:"9-contoh-alur-ui-crud",level:2},{value:"10. Jalankan server",id:"10-jalankan-server",level:2}];function u(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(n.p,{children:["Panduan ini menjelaskan pembuatan modul ",(0,a.jsx)(n.code,{children:"Users"})," secara end-to-end: scaffolding, ",(0,a.jsx)(n.code,{children:"model"}),", ",(0,a.jsx)(n.code,{children:"service"}),", ",(0,a.jsx)(n.code,{children:"container"}),", ",(0,a.jsx)(n.code,{children:"controller"}),", ",(0,a.jsx)(n.code,{children:"route"}),", validasi, dan inspeksi ",(0,a.jsx)(n.code,{children:"route"}),"."]}),"\n",(0,a.jsx)(n.h2,{id:"1-buat-modul-dan-scaffold",children:"1. Buat modul dan scaffold"}),"\n",(0,a.jsx)(n.p,{children:"Mulai dengan membuat modul, model, dan validator:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"flowra make:module users --controllers users,auth\nflowra make:model user --module users --table users\nflowra make:validator user --module users\n"})}),"\n",(0,a.jsxs)(n.p,{children:["Flowra membuat ",(0,a.jsx)(n.code,{children:"app/Modules/Users"})," dan memperbarui manifest. Anda sekarang punya:"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"users.module.js"})," (entry modul)"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"users.container.js"})," (registrasi container)"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"users.routes.js"})," (",(0,a.jsx)(n.code,{children:"route"})," Express)"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"Users.controller.js"})," + ",(0,a.jsx)(n.code,{children:"Auth.controller.js"})]}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.code,{children:"Users.service.js"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.code,{children:"Users.model.js"})}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"2-buat-migrasi-dan-jalankan-database",children:"2. Buat migrasi dan jalankan database"}),"\n",(0,a.jsx)(n.p,{children:"Sebelum mengubah model, buat migrasi agar skema database siap:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"flowra db:migrate:make create_users_table\nflowra db:migrate:latest\n"})}),"\n",(0,a.jsxs)(n.p,{children:["Definisikan tabel ",(0,a.jsx)(n.code,{children:"users"})," di file migrasi dengan kolom seperti ",(0,a.jsx)(n.code,{children:"id"}),", ",(0,a.jsx)(n.code,{children:"name"}),", ",(0,a.jsx)(n.code,{children:"email"}),", ",(0,a.jsx)(n.code,{children:"password_hash"}),", dan ",(0,a.jsx)(n.code,{children:"timestamp"}),"."]}),"\n",(0,a.jsx)(n.p,{children:"Berikut contoh migrasi minimal:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-js",metastring:'title="database/migrations/2026_02_03_000000_create_users_table.js"',children:"exports.up = function (knex) {\n  return knex.schema.createTable('users', (table) => {\n    table.increments('id').primary();\n    table.string('name').notNullable();\n    table.string('email').notNullable().unique();\n    table.string('password_hash').notNullable();\n    table.timestamps(true, true);\n  });\n};\n\nexports.down = function (knex) {\n  return knex.schema.dropTable('users');\n};\n"})}),"\n",(0,a.jsx)(n.h2,{id:"3-perbarui-model-query-builder--knex",children:"3. Perbarui model (Query Builder + Knex)"}),"\n",(0,a.jsxs)(n.p,{children:["Model adalah tempat untuk memusatkan akses database. Model Flowra membungkus query builder Knex, sehingga Anda bisa merangkai ",(0,a.jsx)(n.code,{children:"select"}),", ",(0,a.jsx)(n.code,{children:"where"}),", ",(0,a.jsx)(n.code,{children:"limit"}),", dan join."]}),"\n",(0,a.jsxs)(n.p,{children:["Tambahkan helper ",(0,a.jsx)(n.code,{children:"getAll"})," dan ",(0,a.jsx)(n.code,{children:"getSingle"})," yang sederhana agar mudah dipakai ulang:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-js",metastring:'title="app/Modules/Users/Users.model.js"',children:"const Model = require('../../Config/Model');\n\nclass UsersModel extends Model {\n  constructor(connection = 'default') {\n    super(connection);\n    this.setTable('users');\n    this.setPrimaryKey('id');\n    this.setAllowedFields(['id', 'name', 'email', 'password_hash']);\n    this.setTimestamps(true);\n    this.setSoftDelete(false);\n  }\n\n  getAll({ search, limit = 25, offset = 0 } = {}) {\n    const query = this.read()\n      .select('id', 'name', 'email', 'createdAt')\n      .orderBy('createdAt', 'desc')\n      .limit(limit)\n      .offset(offset);\n\n    if (search) {\n      query.where((builder) => {\n        builder\n          .where('email', 'like', `%${search}%`)\n          .orWhere('name', 'like', `%${search}%`);\n      });\n    }\n\n    return query;\n  }\n\n  getSingle(id) {\n    return this.read()\n      .select('id', 'name', 'email', 'createdAt')\n      .where({ id })\n      .first();\n  }\n\n  findByEmail(email) {\n    return this.read()\n      .select('id', 'name', 'email', 'password_hash')\n      .where({ email })\n      .first();\n  }\n}\n\nmodule.exports = UsersModel;\n"})}),"\n",(0,a.jsxs)(n.p,{children:["Ini memakai layer ",(0,a.jsx)(n.strong,{children:"Query Builder (Knex)"})," Flowra. Untuk pola dan contoh lain, lihat bagian ",(0,a.jsx)(n.a,{href:"../data/models-and-queries#query-builder-knex",children:"Query Builder"}),"."]}),"\n",(0,a.jsx)(n.h2,{id:"4-perbarui-service",children:"4. Perbarui service"}),"\n",(0,a.jsx)(n.p,{children:"Service menangani logika bisnis. Biarkan model menangani query database."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-js",metastring:'title="app/Modules/Users/Users.service.js"',children:"const HttpError = require('../../Errors/HttpError');\n\nclass UsersService {\n  constructor({ models } = {}) {\n    this.usersModel = models.user;\n  }\n\n  async list({ search, limit, offset } = {}) {\n    return this.usersModel.getAll({ search, limit, offset });\n  }\n\n  async get(id) {\n    const user = await this.usersModel.getSingle(id);\n    if (!user) {\n      throw new HttpError(404, 'User not found');\n    }\n    return user;\n  }\n\n  async create(payload) {\n    const id = await this.usersModel.save({\n      name: payload.name,\n      email: payload.email,\n    });\n    return this.get(id);\n  }\n\n  async update(id, payload) {\n    await this.usersModel.update(id, payload);\n    return this.get(id);\n  }\n\n  async remove(id) {\n    await this.usersModel.delete(id);\n    return { ok: true };\n  }\n}\n\nmodule.exports = UsersService;\n"})}),"\n",(0,a.jsx)(n.p,{children:"Untuk alur autentikasi, tambahkan service terpisah agar login/registrasi terpisah dari operasi CRUD:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-js",metastring:'title="app/Modules/Users/Auth.service.js"',children:"const HttpError = require('../../Errors/HttpError');\n\nclass AuthService {\n  constructor({ models, passwordHasher } = {}) {\n    this.usersModel = models.user;\n    this.passwordHasher = passwordHasher;\n  }\n\n  async register(payload) {\n    const passwordHash = await this.passwordHasher.hash(payload.password);\n    const id = await this.usersModel.save({\n      name: payload.name,\n      email: payload.email,\n      password_hash: passwordHash,\n    });\n    return this.usersModel.getSingle(id);\n  }\n\n  async login({ email, password }) {\n    const user = await this.usersModel.findByEmail(email);\n    if (!user) {\n      throw new HttpError(401, 'Invalid credentials');\n    }\n\n    const valid = await this.passwordHasher.compare(password, user.password_hash);\n    if (!valid) {\n      throw new HttpError(401, 'Invalid credentials');\n    }\n\n    return {\n      user: { id: user.id, name: user.name, email: user.email },\n      token: 'replace-with-jwt',\n    };\n  }\n}\n\nmodule.exports = AuthService;\n"})}),"\n",(0,a.jsxs)(n.p,{children:["Daftarkan ",(0,a.jsx)(n.code,{children:"passwordHasher"})," di container utama (misalnya memakai bcrypt atau argon2) agar ",(0,a.jsx)(n.code,{children:"service"})," bisa melakukan hash dan membandingkan password."]}),"\n",(0,a.jsx)(n.h2,{id:"5-controller-dengan-validasi",children:"5. Controller dengan validasi"}),"\n",(0,a.jsx)(n.p,{children:"Controller memvalidasi data masuk lalu memanggil service."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-js",metastring:'title="app/Modules/Users/Users.controller.js"',children:"const HttpError = require('../../Errors/HttpError');\n\nclass UsersController {\n  constructor({ services, validationFactory } = {}) {\n    this.usersService = services.users;\n    this.validationFactory = validationFactory;\n  }\n\n  get createRules() {\n    return {\n      name: { required: true },\n      email: { required: true, is_email: true },\n    };\n  }\n\n  get updateRules() {\n    return {\n      name: { required: false },\n      email: { required: false, is_email: true },\n    };\n  }\n\n  async list(req, res) {\n    const users = await this.usersService.list(req.query);\n    return res.json(users);\n  }\n\n  async show(req, res) {\n    const user = await this.usersService.get(req.params.id);\n    return res.json(user);\n  }\n\n  async create(req, res) {\n    const validator = this.validationFactory(this.createRules);\n    const errors = await validator.validate(req.body);\n    if (errors.length > 0) {\n      throw new HttpError(422, 'Validation failed', errors);\n    }\n\n    const user = await this.usersService.create({\n      name: req.body.name,\n      email: req.body.email,\n    });\n\n    return res.status(201).json(user);\n  }\n\n  async update(req, res) {\n    const validator = this.validationFactory(this.updateRules);\n    const errors = await validator.validate(req.body);\n    if (errors.length > 0) {\n      throw new HttpError(422, 'Validation failed', errors);\n    }\n\n    const user = await this.usersService.update(req.params.id, req.body);\n    return res.json(user);\n  }\n\n  async destroy(req, res) {\n    await this.usersService.remove(req.params.id);\n    return res.status(204).send();\n  }\n}\n\nmodule.exports = UsersController;\n"})}),"\n",(0,a.jsx)(n.p,{children:"Contoh controller autentikasi:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-js",metastring:'title="app/Modules/Users/Auth.controller.js"',children:"const HttpError = require('../../Errors/HttpError');\n\nclass AuthController {\n  constructor({ services, validationFactory } = {}) {\n    this.authService = services.auth;\n    this.validationFactory = validationFactory;\n  }\n\n  get registerRules() {\n    return {\n      name: { required: true },\n      email: { required: true, is_email: true },\n      password: { required: true, minLength: 8 },\n    };\n  }\n\n  get loginRules() {\n    return {\n      email: { required: true, is_email: true },\n      password: { required: true },\n    };\n  }\n\n  async register(req, res) {\n    const validator = this.validationFactory(this.registerRules);\n    const errors = await validator.validate(req.body);\n    if (errors.length > 0) {\n      throw new HttpError(422, 'Validation failed', errors);\n    }\n\n    const user = await this.authService.register(req.body);\n    return res.status(201).json(user);\n  }\n\n  async login(req, res) {\n    const validator = this.validationFactory(this.loginRules);\n    const errors = await validator.validate(req.body);\n    if (errors.length > 0) {\n      throw new HttpError(422, 'Validation failed', errors);\n    }\n\n    const result = await this.authService.login(req.body);\n    return res.json(result);\n  }\n}\n\nmodule.exports = AuthController;\n"})}),"\n",(0,a.jsx)(n.h2,{id:"6-hubungkan-routes",children:"6. Hubungkan routes"}),"\n",(0,a.jsxs)(n.p,{children:["Hubungkan controller di ",(0,a.jsx)(n.code,{children:"users.routes.js"})," agar HTTP layer memanggil logic yang benar:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-js",metastring:'title="app/Modules/Users/users.routes.js"',children:"'use strict';\n\nfunction registerUsersRoutes({ router, container } = {}) {\n  if (!router || !container) {\n    return router;\n  }\n\n  const usersController = container.resolve('modules.users.controllers.users');\n  const authController = container.resolve('modules.users.controllers.auth');\n\n  router.get('/users', usersController.list.bind(usersController));\n  router.get('/users/:id', usersController.show.bind(usersController));\n  router.post('/users', usersController.create.bind(usersController));\n  router.patch('/users/:id', usersController.update.bind(usersController));\n  router.delete('/users/:id', usersController.destroy.bind(usersController));\n\n  router.post('/auth/register', authController.register.bind(authController));\n  router.post('/auth/login', authController.login.bind(authController));\n\n  return router;\n}\n\nmodule.exports = registerUsersRoutes;\n"})}),"\n",(0,a.jsx)(n.h2,{id:"7-daftarkan-semuanya-di-container",children:"7. Daftarkan semuanya di container"}),"\n",(0,a.jsxs)(n.p,{children:["Hubungkan ",(0,a.jsx)(n.code,{children:"model"}),", ",(0,a.jsx)(n.code,{children:"service"}),", ",(0,a.jsx)(n.code,{children:"controller"}),", dan ",(0,a.jsx)(n.code,{children:"route"})," di container modul agar Flowra bisa menyambungkan dependensinya:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-js",metastring:'title="app/Modules/Users/users.container.js"',children:"const { asClass, asValue } = require('awilix');\nconst UsersModel = require('./Users.model');\nconst UsersService = require('./Users.service');\nconst AuthService = require('./Auth.service');\nconst UsersController = require('./Users.controller');\nconst AuthController = require('./Auth.controller');\nconst registerUsersRoutes = require('./users.routes');\n\nmodule.exports = (scope) => {\n  scope.register({\n    models: {\n      user: asClass(UsersModel).singleton(),\n    },\n    services: {\n      users: asClass(UsersService).singleton(),\n      auth: asClass(AuthService).singleton(),\n    },\n    controllers: {\n      users: asClass(UsersController).singleton(),\n      auth: asClass(AuthController).singleton(),\n    },\n    routes: asValue(registerUsersRoutes),\n  });\n};\n"})}),"\n",(0,a.jsx)(n.h2,{id:"8-validasi-modul-dan-cek-routes",children:"8. Validasi modul dan cek routes"}),"\n",(0,a.jsx)(n.p,{children:"Flowra menyediakan perintah untuk mengaktifkan/menonaktifkan modul dan melihat daftar routes:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"flowra module:list\nflowra module:disable users\nflowra module:enable users\nflowra route:list\n"})}),"\n",(0,a.jsx)(n.p,{children:"Ini cara tercepat untuk memastikan modul sudah terpasang sebelum menguji request."}),"\n",(0,a.jsx)(n.h2,{id:"9-contoh-alur-ui-crud",children:"9. Contoh alur UI CRUD"}),"\n",(0,a.jsx)(n.p,{children:"Alur UI tipikal akan memanggil endpoint berikut:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Form registrasi"})," \u2192 ",(0,a.jsx)(n.code,{children:"POST /auth/register"})]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Form login"})," \u2192 ",(0,a.jsx)(n.code,{children:"POST /auth/login"})]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Daftar users"})," \u2192 ",(0,a.jsx)(n.code,{children:"GET /users"})]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Detail user"})," \u2192 ",(0,a.jsx)(n.code,{children:"GET /users/:id"})]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Edit profil"})," \u2192 ",(0,a.jsx)(n.code,{children:"PATCH /users/:id"})]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Hapus user"})," \u2192 ",(0,a.jsx)(n.code,{children:"DELETE /users/:id"})]}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"Semua flow ini langsung terhubung ke controller yang Anda buat."}),"\n",(0,a.jsx)(n.h2,{id:"10-jalankan-server",children:"10. Jalankan server"}),"\n",(0,a.jsx)(n.p,{children:"Sebelum menjalankan, cek environment variables:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"flowra env:check\n"})}),"\n",(0,a.jsx)(n.p,{children:"Jalankan server:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"npm run dev\n"})}),"\n",(0,a.jsxs)(n.p,{children:["Buka ",(0,a.jsx)(n.code,{children:"http://localhost:3387/users"})," untuk memastikan API mengembalikan data."]}),"\n",(0,a.jsx)(n.admonition,{title:"Langkah berikutnya",type:"tip",children:(0,a.jsxs)(n.p,{children:["Pelajari ",(0,a.jsx)(n.a,{href:"../routing/routes-and-controllers",children:"Routing guide"})," atau perdalam data layer di ",(0,a.jsx)(n.a,{href:"../data/models-and-queries",children:"Models & Queries"}),"."]})})]})}function c(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(u,{...e})}):u(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>i,x:()=>l});var s=r(6540);const a={},t=s.createContext(a);function i(e){const n=s.useContext(t);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:i(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);