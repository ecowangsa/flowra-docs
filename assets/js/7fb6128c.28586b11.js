"use strict";(globalThis.webpackChunkflowra_docs=globalThis.webpackChunkflowra_docs||[]).push([[890],{8453:(e,r,s)=>{s.d(r,{R:()=>a,x:()=>o});var n=s(6540);const t={},i=n.createContext(t);function a(e){const r=n.useContext(i);return n.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function o(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:a(e.components),n.createElement(i.Provider,{value:r},e.children)}},9324:(e,r,s)=>{s.r(r),s.d(r,{assets:()=>l,contentTitle:()=>o,default:()=>u,frontMatter:()=>a,metadata:()=>n,toc:()=>d});const n=JSON.parse('{"id":"getting-started/first-api","title":"Build Your First API","description":"Generate a Users module with CRUD + auth, validate requests, and wire everything through Flowra.","source":"@site/docs/getting-started/first-api.mdx","sourceDirName":"getting-started","slug":"/getting-started/first-api","permalink":"/docs/getting-started/first-api","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"Build Your First API","description":"Generate a Users module with CRUD + auth, validate requests, and wire everything through Flowra."},"sidebar":"docsSidebar","previous":{"title":"Project Structure","permalink":"/docs/getting-started/project-structure"},"next":{"title":"Configuration Overview","permalink":"/docs/configuration/overview"}}');var t=s(4848),i=s(8453);const a={title:"Build Your First API",description:"Generate a Users module with CRUD + auth, validate requests, and wire everything through Flowra."},o=void 0,l={},d=[{value:"1. Generate the module and scaffolds",id:"1-generate-the-module-and-scaffolds",level:2},{value:"2. Create the migration and migrate the database",id:"2-create-the-migration-and-migrate-the-database",level:2},{value:"3. Update the model (Query Builder + Knex)",id:"3-update-the-model-query-builder--knex",level:2},{value:"4. Update the services",id:"4-update-the-services",level:2},{value:"5. Build controllers with validation",id:"5-build-controllers-with-validation",level:2},{value:"6. Wire the routes",id:"6-wire-the-routes",level:2},{value:"7. Register everything in the container",id:"7-register-everything-in-the-container",level:2},{value:"8. Validate the module and inspect routes",id:"8-validate-the-module-and-inspect-routes",level:2},{value:"9. Sample CRUD UI flow",id:"9-sample-crud-ui-flow",level:2},{value:"10. Run the server",id:"10-run-the-server",level:2}];function c(e){const r={a:"a",admonition:"admonition",code:"code",h2:"h2",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(r.p,{children:"Build a complete Users module with scaffolding, models, services, container registration, controllers, routes, validation, and route inspection."}),"\n",(0,t.jsx)(r.h2,{id:"1-generate-the-module-and-scaffolds",children:"1. Generate the module and scaffolds"}),"\n",(0,t.jsx)(r.p,{children:"Start by generating the module, model, and validator:"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"flowra make:module users --controllers users,auth\nflowra make:model user --module users --table users\nflowra make:validator user --module users\n"})}),"\n",(0,t.jsxs)(r.p,{children:["Flowra creates ",(0,t.jsx)(r.code,{children:"app/Modules/Users"})," and updates the manifest. You should now have:"]}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.code,{children:"users.module.js"})," (module entry)"]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.code,{children:"users.container.js"})," (container registration)"]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.code,{children:"users.routes.js"})," (Express routes)"]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.code,{children:"Users.controller.js"})," + ",(0,t.jsx)(r.code,{children:"Auth.controller.js"})]}),"\n",(0,t.jsx)(r.li,{children:(0,t.jsx)(r.code,{children:"Users.service.js"})}),"\n",(0,t.jsx)(r.li,{children:(0,t.jsx)(r.code,{children:"Users.model.js"})}),"\n"]}),"\n",(0,t.jsx)(r.h2,{id:"2-create-the-migration-and-migrate-the-database",children:"2. Create the migration and migrate the database"}),"\n",(0,t.jsx)(r.p,{children:"Before updating the model, create a migration so your database schema is ready:"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"flowra db:migrate:make create_users_table\nflowra db:migrate:latest\n"})}),"\n",(0,t.jsxs)(r.p,{children:["Define the ",(0,t.jsx)(r.code,{children:"users"})," table in the generated migration using columns like ",(0,t.jsx)(r.code,{children:"id"}),", ",(0,t.jsx)(r.code,{children:"name"}),", ",(0,t.jsx)(r.code,{children:"email"}),", ",(0,t.jsx)(r.code,{children:"password_hash"}),", and timestamps."]}),"\n",(0,t.jsx)(r.p,{children:"Here is a minimal migration example:"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-js",metastring:'title="database/migrations/2026_02_03_000000_create_users_table.js"',children:"exports.up = function (knex) {\n  return knex.schema.createTable('users', (table) => {\n    table.increments('id').primary();\n    table.string('name').notNullable();\n    table.string('email').notNullable().unique();\n    table.string('password_hash').notNullable();\n    table.timestamps(true, true);\n  });\n};\n\nexports.down = function (knex) {\n  return knex.schema.dropTable('users');\n};\n"})}),"\n",(0,t.jsx)(r.h2,{id:"3-update-the-model-query-builder--knex",children:"3. Update the model (Query Builder + Knex)"}),"\n",(0,t.jsxs)(r.p,{children:["The model is where you centralize database access. Flowra models wrap the Knex query builder, so you can chain ",(0,t.jsx)(r.code,{children:"select"}),", ",(0,t.jsx)(r.code,{children:"where"}),", ",(0,t.jsx)(r.code,{children:"limit"}),", and joins."]}),"\n",(0,t.jsxs)(r.p,{children:["Add simple ",(0,t.jsx)(r.code,{children:"getAll"})," and ",(0,t.jsx)(r.code,{children:"getSingle"})," helpers that you can reuse throughout the app:"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-js",metastring:'title="app/Modules/Users/Users.model.js"',children:"const Model = require('../../Config/Model');\n\nclass UsersModel extends Model {\n  constructor(connection = 'default') {\n    super(connection);\n    this.setTable('users');\n    this.setPrimaryKey('id');\n    this.setAllowedFields(['id', 'name', 'email', 'password_hash']);\n    this.setTimestamps(true);\n    this.setSoftDelete(false);\n  }\n\n  getAll({ search, limit = 25, offset = 0 } = {}) {\n    const query = this.read()\n      .select('id', 'name', 'email', 'createdAt')\n      .orderBy('createdAt', 'desc')\n      .limit(limit)\n      .offset(offset);\n\n    if (search) {\n      query.where((builder) => {\n        builder\n          .where('email', 'like', `%${search}%`)\n          .orWhere('name', 'like', `%${search}%`);\n      });\n    }\n\n    return query;\n  }\n\n  getSingle(id) {\n    return this.read()\n      .select('id', 'name', 'email', 'createdAt')\n      .where({ id })\n      .first();\n  }\n\n  findByEmail(email) {\n    return this.read()\n      .select('id', 'name', 'email', 'password_hash')\n      .where({ email })\n      .first();\n  }\n}\n\nmodule.exports = UsersModel;\n"})}),"\n",(0,t.jsxs)(r.p,{children:["This uses Flowra\u2019s ",(0,t.jsx)(r.strong,{children:"Query Builder (Knex)"})," layer. For more examples and patterns, see the ",(0,t.jsx)(r.a,{href:"../data/models-and-queries#query-builder-knex",children:"Query Builder"})," section."]}),"\n",(0,t.jsx)(r.h2,{id:"4-update-the-services",children:"4. Update the services"}),"\n",(0,t.jsx)(r.p,{children:"Services own the business logic. Keep them thin and let the model handle database queries."}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-js",metastring:'title="app/Modules/Users/Users.service.js"',children:"const HttpError = require('../../Errors/HttpError');\n\nclass UsersService {\n  constructor({ models } = {}) {\n    this.usersModel = models.user;\n  }\n\n  async list({ search, limit, offset } = {}) {\n    return this.usersModel.getAll({ search, limit, offset });\n  }\n\n  async get(id) {\n    const user = await this.usersModel.getSingle(id);\n    if (!user) {\n      throw new HttpError(404, 'User not found');\n    }\n    return user;\n  }\n\n  async create(payload) {\n    const id = await this.usersModel.save({\n      name: payload.name,\n      email: payload.email,\n    });\n    return this.get(id);\n  }\n\n  async update(id, payload) {\n    await this.usersModel.update(id, payload);\n    return this.get(id);\n  }\n\n  async remove(id) {\n    await this.usersModel.delete(id);\n    return { ok: true };\n  }\n}\n\nmodule.exports = UsersService;\n"})}),"\n",(0,t.jsx)(r.p,{children:"For authentication flows, add a dedicated service so login/registration stays separated from CRUD:"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-js",metastring:'title="app/Modules/Users/Auth.service.js"',children:"const HttpError = require('../../Errors/HttpError');\n\nclass AuthService {\n  constructor({ models, passwordHasher } = {}) {\n    this.usersModel = models.user;\n    this.passwordHasher = passwordHasher;\n  }\n\n  async register(payload) {\n    const passwordHash = await this.passwordHasher.hash(payload.password);\n    const id = await this.usersModel.save({\n      name: payload.name,\n      email: payload.email,\n      password_hash: passwordHash,\n    });\n    return this.usersModel.getSingle(id);\n  }\n\n  async login({ email, password }) {\n    const user = await this.usersModel.findByEmail(email);\n    if (!user) {\n      throw new HttpError(401, 'Invalid credentials');\n    }\n\n    const valid = await this.passwordHasher.compare(password, user.password_hash);\n    if (!valid) {\n      throw new HttpError(401, 'Invalid credentials');\n    }\n\n    return {\n      user: { id: user.id, name: user.name, email: user.email },\n      token: 'replace-with-jwt',\n    };\n  }\n}\n\nmodule.exports = AuthService;\n"})}),"\n",(0,t.jsxs)(r.p,{children:["Register ",(0,t.jsx)(r.code,{children:"passwordHasher"})," in your root container (e.g., using bcrypt or argon2) so the service can hash and compare passwords."]}),"\n",(0,t.jsx)(r.h2,{id:"5-build-controllers-with-validation",children:"5. Build controllers with validation"}),"\n",(0,t.jsx)(r.p,{children:"Controllers validate incoming data and call the services."}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-js",metastring:'title="app/Modules/Users/Users.controller.js"',children:"const HttpError = require('../../Errors/HttpError');\n\nclass UsersController {\n  constructor({ services, validationFactory } = {}) {\n    this.usersService = services.users;\n    this.validationFactory = validationFactory;\n  }\n\n  get createRules() {\n    return {\n      name: { required: true },\n      email: { required: true, is_email: true },\n    };\n  }\n\n  get updateRules() {\n    return {\n      name: { required: false },\n      email: { required: false, is_email: true },\n    };\n  }\n\n  async list(req, res) {\n    const users = await this.usersService.list(req.query);\n    return res.json(users);\n  }\n\n  async show(req, res) {\n    const user = await this.usersService.get(req.params.id);\n    return res.json(user);\n  }\n\n  async create(req, res) {\n    const validator = this.validationFactory(this.createRules);\n    const errors = await validator.validate(req.body);\n    if (errors.length > 0) {\n      throw new HttpError(422, 'Validation failed', errors);\n    }\n\n    const user = await this.usersService.create({\n      name: req.body.name,\n      email: req.body.email,\n    });\n\n    return res.status(201).json(user);\n  }\n\n  async update(req, res) {\n    const validator = this.validationFactory(this.updateRules);\n    const errors = await validator.validate(req.body);\n    if (errors.length > 0) {\n      throw new HttpError(422, 'Validation failed', errors);\n    }\n\n    const user = await this.usersService.update(req.params.id, req.body);\n    return res.json(user);\n  }\n\n  async destroy(req, res) {\n    await this.usersService.remove(req.params.id);\n    return res.status(204).send();\n  }\n}\n\nmodule.exports = UsersController;\n"})}),"\n",(0,t.jsx)(r.p,{children:"Authentication controller example:"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-js",metastring:'title="app/Modules/Users/Auth.controller.js"',children:"const HttpError = require('../../Errors/HttpError');\n\nclass AuthController {\n  constructor({ services, validationFactory } = {}) {\n    this.authService = services.auth;\n    this.validationFactory = validationFactory;\n  }\n\n  get registerRules() {\n    return {\n      name: { required: true },\n      email: { required: true, is_email: true },\n      password: { required: true, minLength: 8 },\n    };\n  }\n\n  get loginRules() {\n    return {\n      email: { required: true, is_email: true },\n      password: { required: true },\n    };\n  }\n\n  async register(req, res) {\n    const validator = this.validationFactory(this.registerRules);\n    const errors = await validator.validate(req.body);\n    if (errors.length > 0) {\n      throw new HttpError(422, 'Validation failed', errors);\n    }\n\n    const user = await this.authService.register(req.body);\n    return res.status(201).json(user);\n  }\n\n  async login(req, res) {\n    const validator = this.validationFactory(this.loginRules);\n    const errors = await validator.validate(req.body);\n    if (errors.length > 0) {\n      throw new HttpError(422, 'Validation failed', errors);\n    }\n\n    const result = await this.authService.login(req.body);\n    return res.json(result);\n  }\n}\n\nmodule.exports = AuthController;\n"})}),"\n",(0,t.jsx)(r.h2,{id:"6-wire-the-routes",children:"6. Wire the routes"}),"\n",(0,t.jsxs)(r.p,{children:["Bind the controllers in ",(0,t.jsx)(r.code,{children:"users.routes.js"})," so the HTTP layer maps to your logic:"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-js",metastring:'title="app/Modules/Users/users.routes.js"',children:"'use strict';\n\nfunction registerUsersRoutes({ router, container } = {}) {\n  if (!router || !container) {\n    return router;\n  }\n\n  const usersController = container.resolve('modules.users.controllers.users');\n  const authController = container.resolve('modules.users.controllers.auth');\n\n  router.get('/users', usersController.list.bind(usersController));\n  router.get('/users/:id', usersController.show.bind(usersController));\n  router.post('/users', usersController.create.bind(usersController));\n  router.patch('/users/:id', usersController.update.bind(usersController));\n  router.delete('/users/:id', usersController.destroy.bind(usersController));\n\n  router.post('/auth/register', authController.register.bind(authController));\n  router.post('/auth/login', authController.login.bind(authController));\n\n  return router;\n}\n\nmodule.exports = registerUsersRoutes;\n"})}),"\n",(0,t.jsx)(r.h2,{id:"7-register-everything-in-the-container",children:"7. Register everything in the container"}),"\n",(0,t.jsx)(r.p,{children:"Wire models, services, controllers, and routes in the module container so Flowra can resolve them by name:"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-js",metastring:'title="app/Modules/Users/users.container.js"',children:"const { asClass, asValue } = require('awilix');\nconst UsersModel = require('./Users.model');\nconst UsersService = require('./Users.service');\nconst AuthService = require('./Auth.service');\nconst UsersController = require('./Users.controller');\nconst AuthController = require('./Auth.controller');\nconst registerUsersRoutes = require('./users.routes');\n\nmodule.exports = (scope) => {\n  scope.register({\n    models: {\n      user: asClass(UsersModel).singleton(),\n    },\n    services: {\n      users: asClass(UsersService).singleton(),\n      auth: asClass(AuthService).singleton(),\n    },\n    controllers: {\n      users: asClass(UsersController).singleton(),\n      auth: asClass(AuthController).singleton(),\n    },\n    routes: asValue(registerUsersRoutes),\n  });\n};\n"})}),"\n",(0,t.jsx)(r.h2,{id:"8-validate-the-module-and-inspect-routes",children:"8. Validate the module and inspect routes"}),"\n",(0,t.jsx)(r.p,{children:"Flowra lets you enable/disable modules and inspect what routes are active:"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"flowra module:list\nflowra module:disable users\nflowra module:enable users\nflowra route:list\n"})}),"\n",(0,t.jsx)(r.p,{children:"This is the quickest way to verify that your module is wired correctly before testing requests."}),"\n",(0,t.jsx)(r.h2,{id:"9-sample-crud-ui-flow",children:"9. Sample CRUD UI flow"}),"\n",(0,t.jsx)(r.p,{children:"A typical UI flow calls these endpoints in order:"}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"Registration form"})," \u2192 ",(0,t.jsx)(r.code,{children:"POST /auth/register"})]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"Login form"})," \u2192 ",(0,t.jsx)(r.code,{children:"POST /auth/login"})]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"Users list"})," \u2192 ",(0,t.jsx)(r.code,{children:"GET /users"})]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"User details"})," \u2192 ",(0,t.jsx)(r.code,{children:"GET /users/:id"})]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"Edit profile"})," \u2192 ",(0,t.jsx)(r.code,{children:"PATCH /users/:id"})]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"Delete user"})," \u2192 ",(0,t.jsx)(r.code,{children:"DELETE /users/:id"})]}),"\n"]}),"\n",(0,t.jsx)(r.p,{children:"This maps cleanly to the controller methods you just created."}),"\n",(0,t.jsx)(r.h2,{id:"10-run-the-server",children:"10. Run the server"}),"\n",(0,t.jsx)(r.p,{children:"Before running, you can check environment variables:"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"flowra env:check\n"})}),"\n",(0,t.jsx)(r.p,{children:"Start the server:"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"npm run dev\n"})}),"\n",(0,t.jsxs)(r.p,{children:["Visit ",(0,t.jsx)(r.code,{children:"http://localhost:3387/users"})," to confirm the API returns data."]}),"\n",(0,t.jsx)(r.admonition,{title:"Next ideas",type:"tip",children:(0,t.jsxs)(r.p,{children:["Explore the ",(0,t.jsx)(r.a,{href:"../routing/routes-and-controllers",children:"Routing guide"})," or deepen the data layer in ",(0,t.jsx)(r.a,{href:"../data/models-and-queries",children:"Models & Queries"}),"."]})})]})}function u(e={}){const{wrapper:r}={...(0,i.R)(),...e.components};return r?(0,t.jsx)(r,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}}}]);