"use strict";(globalThis.webpackChunkflowra_docs=globalThis.webpackChunkflowra_docs||[]).push([[315],{5449:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>i,contentTitle:()=>l,default:()=>u,frontMatter:()=>d,metadata:()=>s,toc:()=>a});const s=JSON.parse('{"id":"examples/users-api","title":"Example: Users API","description":"Extend the scaffolded Users module into a simple CRUD API.","source":"@site/docs/examples/users-api.mdx","sourceDirName":"examples","slug":"/examples/users-api","permalink":"/docs/examples/users-api","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"Example: Users API","description":"Extend the scaffolded Users module into a simple CRUD API."},"sidebar":"docsSidebar","previous":{"title":"FAQ","permalink":"/docs/faq/"},"next":{"title":"JWT Auth + File Uploads","permalink":"/docs/examples/jwt-multer"}}');var t=r(4848),o=r(8453);const d={title:"Example: Users API",description:"Extend the scaffolded Users module into a simple CRUD API."},l=void 0,i={},a=[{value:"1. Run the migration",id:"1-run-the-migration",level:2},{value:"2. Update routes",id:"2-update-routes",level:2},{value:"3. Add update and delete logic",id:"3-add-update-and-delete-logic",level:2},{value:"4. Run and test",id:"4-run-and-test",level:2}];function c(e){const n={admonition:"admonition",code:"code",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,o.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.p,{children:"This example builds on the default Users module that ships with new Flowra projects."}),"\n",(0,t.jsx)(n.h2,{id:"1-run-the-migration",children:"1. Run the migration"}),"\n",(0,t.jsxs)(n.p,{children:["The scaffold includes a migration for the ",(0,t.jsx)(n.code,{children:"users"})," table."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"flowra db:migrate:latest\n"})}),"\n",(0,t.jsx)(n.h2,{id:"2-update-routes",children:"2. Update routes"}),"\n",(0,t.jsx)(n.p,{children:"Switch the Users routes to a more RESTful shape:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",metastring:'title="app/Modules/Users/users.routes.js"',children:"'use strict';\nconst group = require('routergroup');\n\nmodule.exports = ({ router, container } = {}) => {\n  if (!router || !container) {\n    return router;\n  }\n\n  const controller = container.resolve('modules.users.controllers.main');\n\n  router.use(\n    group('/users', (router) => {\n      router.get('/', controller.list.bind(controller));\n      router.post('/', controller.create.bind(controller));\n      router.put('/:id', controller.update.bind(controller));\n      router.delete('/:id', controller.destroy.bind(controller));\n    })\n  );\n\n  return router;\n};\n"})}),"\n",(0,t.jsx)(n.h2,{id:"3-add-update-and-delete-logic",children:"3. Add update and delete logic"}),"\n",(0,t.jsxs)(n.p,{children:["Extend the controller and service with ",(0,t.jsx)(n.code,{children:"update"})," and ",(0,t.jsx)(n.code,{children:"destroy"})," methods."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",metastring:'title="app/Modules/Users/Users.controller.js"',children:"update = async (req, res, next) => {\n  try {\n    const result = await this.usersService.update(req.params.id, req.body);\n    res.json({ message: 'Updated', data: result });\n  } catch (error) {\n    next(error);\n  }\n};\n\ndestroy = async (req, res, next) => {\n  try {\n    await this.usersService.destroy(req.params.id);\n    res.status(204).end();\n  } catch (error) {\n    next(error);\n  }\n};\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",metastring:'title="app/Modules/Users/Users.service.js"',children:"async update(id, payload) {\n  return this.userModel.update(id, payload);\n}\n\nasync destroy(id) {\n  return this.userModel.delete(id);\n}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"4-run-and-test",children:"4. Run and test"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"npm run dev\n"})}),"\n",(0,t.jsx)(n.p,{children:"Now you can call:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"GET /users"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"POST /users"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"PUT /users/:id"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"DELETE /users/:id"})}),"\n"]}),"\n",(0,t.jsx)(n.admonition,{title:"Next steps",type:"tip",children:(0,t.jsxs)(n.p,{children:["Try adding validation rules to ",(0,t.jsx)(n.code,{children:"update()"})," or introduce a query class for reporting."]})})]})}function u(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>d,x:()=>l});var s=r(6540);const t={},o=s.createContext(t);function d(e){const n=s.useContext(o);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:d(e.components),s.createElement(o.Provider,{value:n},e.children)}}}]);