---
id: deployment
slug: /deployment/guide
sidebar_position: 15
---

# Panduan Deployment

## Build untuk produksi
1. Pasang dependensi menggunakan package manager yang terkunci: `npm ci`.
2. Kompilasi TypeScript: `npm run build` (output ke `dist/`).
3. Salin file environment (`.env.production`) dan pastikan secret di-inject saat runtime.
4. Jalankan migrasi database sebelum aplikasi start: `npx flowra migrate`.

## Konfigurasi environment
- `APP_ENV` – nama environment (`production`, `staging`).
- `APP_PORT` – port HTTP (default `3000`).
- `LOG_LEVEL` – `info` untuk produksi, `debug` untuk staging.
- `DB_*` – kredensial database (lihat [Knex setup](/docs/id/data/knex-setup)).
- `TRUST_PROXY` – set `true` jika berada di belakang reverse proxy.

## Process manager
Gunakan supervisor seperti PM2, systemd, atau Docker untuk menjaga aplikasi tetap hidup:

```bash
pm2 start dist/main/bootstrap.js --name flowra-api --env production
```

Contoh berkas ekosistem PM2:

```js
module.exports = {
  apps: [
    {
      name: 'flowra-api',
      script: 'dist/main/bootstrap.js',
      env: {
        NODE_ENV: 'production',
        APP_ENV: 'production',
      },
    },
  ],
};
```

## Deployment dengan Docker
```dockerfile
FROM node:20-alpine
WORKDIR /app
COPY package*.json ./
RUN npm ci --omit=dev
COPY . .
RUN npm run build
CMD ["node", "dist/main/bootstrap.js"]
```

Jalankan dengan variabel lingkungan:

```bash
docker build -t flowra-api .
docker run -p 3000:3000 --env-file .env.production flowra-api
```

## Logging & monitoring
- Teruskan stdout/stderr ke stack logging (ELK, Datadog, CloudWatch).
- Sertakan request ID dengan mengaktifkan middleware logging di `core/http/middleware/logger.middleware.ts`.
- Emit metrik kustom melalui `core/events` dan kirim ke Prometheus atau StatsD.

## Checklist produksi
| Item | Aksi |
| ---- | ---- |
| Migrasi | Jalankan `npx flowra migrate` saat deploy. |
| Health check | Ekspose endpoint `/health`; konfigurasikan load balancer untuk polling. |
| Backup | Jadwalkan backup database sesuai RPO/RTO. |
| Secret | Rotasi API key dan password database secara rutin. |
| Observabilitas | Buat alert untuk error rate, latensi, kedalaman antrean. |

## Strategi scaling
- **Horizontal scaling** – jalankan beberapa instance di balik load balancer; aktifkan sticky session jika autentikasi stateful.
- **Database pooling** – sesuaikan `DB_POOL_MIN`/`DB_POOL_MAX` dengan batas koneksi.
- **Background job** – pindahkan pekerjaan berat ke antrian menggunakan provider di `core/queues`.
- **Static asset** – layani melalui CDN atau object storage, bukan proses Node.

> **note**
> Jaga environment staging yang meniru produksi untuk memvalidasi migrasi, caching, dan wiring service container sebelum rilis.
