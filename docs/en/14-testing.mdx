---
id: testing
slug: /testing/overview
sidebar_position: 14
---

# Testing Strategy

## Running tests
Flowra projects ship with Jest configured in `package.json`:

```json
{
  "scripts": {
    "test": "jest",
    "test:watch": "jest --watch",
    "test:coverage": "jest --coverage"
  }
}
```

Run the suite with `npm test`. Use `npm run test:watch` while developing modules.

## Test scaffolding
Use the CLI to generate test files:

```bash
npx flowra make:test users/user-service --type unit
npx flowra make:test users/user-controller --type integration
```

The generator places files under `tests/<module>/` and bootstraps the application test module.

## Testing services
`core/testing/application-test-module.ts` spins up the container with optional overrides.

```ts
import {createTestApplication} from '../../core/testing/application-test-module';
import {UsersModule} from '../../app/modules/users';
import {UserService} from '../../app/modules/users/services/user.service';

describe('UserService', () => {
  it('creates a user', async () => {
    const app = await createTestApplication({modules: [UsersModule]});
    const service = app.container.resolve(UserService);

    const user = await service.create({email: 'ada@example.com', name: 'Ada'});
    expect(user.email).toBe('ada@example.com');
  });
});
```

Override dependencies per test:

```ts
const app = await createTestApplication({
  modules: [UsersModule],
  overrides: [
    {
      token: 'Database.primary',
      useValue: inMemoryDatabase,
    },
  ],
});
```

## Testing HTTP endpoints
Integration tests use SuperTest or Flowra's HTTP helper:

```ts
import request from 'supertest';
import {createHttpTestApp} from '../../core/testing/http-test-app';

const app = await createHttpTestApp({modules: [UsersModule]});

await request(app.getHttpServer())
  .post('/users')
  .send({email: 'ada@example.com', name: 'Ada'})
  .expect(201);
```

## Recommended test structure
```
tests/
├─ users/
│  ├─ user-service.spec.ts
│  └─ user-controller.spec.ts
├─ billing/
│  └─ invoice-service.spec.ts
└─ support/
   └─ fixtures/
```

## When tests are missing
If the project lacks tests, adopt this baseline:

- **Unit tests** – cover services and helpers with Jest + container overrides.
- **Integration tests** – cover HTTP endpoints via SuperTest and the test application bootstrap.
- **Database tests** – run against an ephemeral database (SQLite, Docker) with migrations executed before the suite (`npx flowra migrate`).
- **Factories/fixtures** – build factories under `tests/support/factories` to reduce duplication.

> **note**
> Use `npm run test:coverage` to ensure critical modules maintain coverage targets agreed by the team.
