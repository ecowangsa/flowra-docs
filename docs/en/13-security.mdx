---
id: security
slug: /security/overview
sidebar_position: 13
---

# Security in Flowra

## Defensive defaults
Flowra's HTTP kernel (`core/http/kernel.ts`) applies essential middlewares: Helmet for headers, CORS restrictions, JSON body limits, and request ID correlation. Ensure these remain enabled in production.

## Middleware catalogue
- **Authentication** – place JWT or session verification in `app/modules/auth/http/middlewares/auth.middleware.ts`. Inject services for token validation.
- **Rate limiting** – use `core/http/middleware/rate-limit.middleware.ts` to protect sensitive routes; configure Redis stores via the service container.
- **CSRF protection** – applicable for web apps using server-rendered views; use the token generator in `core/http/security/csrf.ts`.
- **Input sanitisation** – leverage Zod schemas and escape utilities in `core/http/validation/sanitise.ts`.

## Validation strategies
> **tip**
> Always validate at the edge. Keep `http/requests/*.request.ts` as the first line of defence before a controller calls services.

- Use Zod or Yup schemas to enforce formats and convert data types.
- Normalise dates, numbers, and enums to prevent SQL injection via untyped input.
- Throw `ValidationException` to return consistent 422 responses with field-level errors.

## Secrets management
- Store secrets in `.env` or your platform's secret manager. Never commit `.env` to version control.
- Use the configuration service (`core/config/config.service.ts`) to access secrets, not `process.env` directly, so tests can override values.
- Rotate credentials regularly and prefer scoped API keys.

## Error handling
`core/http/responses/error-handler.ts` centralises exception mapping. Custom errors should extend `HttpException` and include safe messages. Avoid leaking stack traces—set `APP_DEBUG=false` in production.

## Production checklist
| Item | Purpose |
| ---- | ------- |
| HTTPS termination | Ensure TLS either at Flowra or at the upstream proxy. |
| Reverse proxy headers | Configure `TRUST_PROXY=true` so Express respects `X-Forwarded-*`. |
| Secure cookies | Set `SESSION_SECURE=true` and `SESSION_SAME_SITE=strict` when using sessions. |
| Logging | Pipe logs to a central system; include request IDs for correlation. |
| Monitoring | Integrate with APM tools using hooks in `core/events`. |

## Additional guidance
- Limit middleware per module to the minimal scope required.
- Use parameterised queries in models to avoid SQL injection (Knex handles this when using placeholders).
- Validate file uploads by size and MIME type (`core/http/middleware/upload.middleware.ts`).
- Keep dependencies updated; run `npm audit` regularly.

> **warning**
> Never trust data received from external APIs. Normalise and validate responses before saving or forwarding them.
